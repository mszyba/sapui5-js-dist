/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/base/Object","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/m/IconTabFilter","sap/m/IconTabHeader","sap/m/library","sap/uxap/ObjectPageSection"],function(t,e,o,r,n,a,i,s){"use strict";var c=i.TabsOverflowMode;var g=i.IconTabHeaderMode;var u=e.extend("sap.uxap._helpers.AB",{constructor:function(t){this._oObjectPageLayout=t;this._oObserver=new r(this._proxyStateChanges.bind(this))},getInterface:function(){return this}});u._focusSection=function(t,e){var o=t.getDomRef();if(o){o.focus(e)}};u.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};u.prototype._getAnchorBar=function(){var t=this.getObjectPageLayout(),e=t.getAggregation("_anchorBar"),r=t.getUpperCaseAnchorBar();if(!e){e=new a({id:t.getId()+"-anchBar",tabsOverflowMode:c.StartAndEnd,backgroundDesign:o.escapeSettingsValue(t.getBackgroundDesignAnchorBar()),mode:g.Inline});e.attachSelect(function(e){var o=e.getParameter("key");this._moveFocusOnSection(o);t.onAnchorBarTabPress(o)}.bind(this));e.addEventDelegate({onAfterRendering:function(){t._adjustTitlePositioning();this._clearAnchorBarFixedHeight(e)}.bind(this)});if(r){e.addStyleClass("sapUxAPAnchorBarUpperCase")}this.getObjectPageLayout().setAggregation("_anchorBar",e,true)}return e};u.prototype._fixAnchorBarHeight=function(t){var e=t.getDomRef()?.parentNode;if(e){e.style.height=e.clientHeight+"px"}};u.prototype._clearAnchorBarFixedHeight=function(t){var e=t.getDomRef()?.parentNode;if(e){e.style.height="auto"}};u.prototype._buildAnchorBar=function(){var t=this.getObjectPageLayout(),e=this._getAnchorBar(),r=t.getUpperCaseAnchorBar();this.resetControl();this._oObserver.disconnect();t._getVisibleSections().forEach(function(a){var i=e.getId()+"-"+a.getId()+"-anchor",s=new n(i,{text:o.escapeSettingsValue(a._getTitle()),key:a.getId(),iconColor:o.escapeSettingsValue(a.getAnchorBarButtonColor())}),c=a._getVisibleSubSections();this._setupCustomButtonForwarding(a,s,r);if(t.getShowAnchorBarPopover()){if(c.length>1){c.forEach(function(t){var r=e.getId()+"-"+t.getId()+"-anchor",a=new n(r,{text:o.escapeSettingsValue(t._getTitle()),key:t.getId()});s.addItem(a);this._setupCustomButtonForwarding(t,a)},this)}else if(c.length===1&&!a.getCustomAnchorBarButton()&&c[0]._getTitle()?.trim()){s.setText(c[0]._getTitle());this._setupCustomButtonForwarding(c[0],s,r)}}e.addItem(s)},this);t.setAggregation("_anchorBar",e)};u.prototype._setupCustomButtonForwarding=function(t,e,o){var r=t.getCustomAnchorBarButton();if(!r){return}e.setText(r.getText());e.setIcon(r.getIcon());this._oObserver.observe(r,{properties:true});this._getAnchorBar().attachSelect(function(t){this._forwardPressToCustomButton(t.getParameter("item"))},this)};u.prototype._forwardPressToCustomButton=function(e){var o=e.getKey(),r=t.getElementById(o),n=r?.getCustomAnchorBarButton();if(n){n.firePress()}};u.prototype.resetControl=function(){var t=this._getAnchorBar();this._fixAnchorBarHeight(t);t.destroyItems()};u.prototype.selectAnchorForSection=function(t){var e=sap.ui.getCore().byId(t),o;if(!e){return}o=e.isA("sap.uxap.ObjectPageSubSection");if(o){t=e.getParent().getId()}this._getAnchorBar().setSelectedKey(t)};u.prototype._setAnchorButtonsTabFocusValues=function(t){var e=this._getAnchorBar().getItems(),o,r="0",n="-1",a="tabIndex";e.forEach(function(e){o=e.$();if(e.getKey()===t){o.attr(a,r)}else{o.attr(a,n)}})};u.prototype._moveFocusOnSection=function(e){var o=t.getElementById(e),r,n,a={preventScroll:true},i;if(!o){return}if(!o.isActive()){i={onAfterRendering:function(){o.removeEventDelegate(i);u._focusSection(o,a)}};o.addEventDelegate(i);return}r=s._getClosestSection(o);n=this._getAnchorBar().getItems().find(t=>t.getKey()===r.getId());if(document.activeElement!==n.getDomRef()){i={onfocusin:function(){n.removeEventDelegate(i);u._focusSection(o,a)}};n.addEventDelegate(i)}u._focusSection(o,a)};u.prototype._proxyStateChanges=function(t){var e=t.object,o=e.getParent(),r=this._findAnchorForSectionBase(o),n=t.name,a=t.current,i="set"+h(n);if(r){r[i].call(r,a)}};u.prototype._findAnchorForSectionBase=function(t){var e=t?.getId(),o=this._getAnchorBar(),r=o.getItems(),n,a=function(t){return t.some(function(t){if(t.getKey()===e){n=t;return true}return a(t.getItems())})};a(r);return n};function h(t){return t.substring(0,1).toUpperCase()+t.substring(1)}return u});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map